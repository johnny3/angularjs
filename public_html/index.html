<!DOCTYPE html>

<html>
    <head>
        <title>Angular formation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
        <script src="https://code.angularjs.org/1.3.15/angular-route.min.js"></script>
        <script>
            var app = angular.module('myApp', ['ngRoute']);

            app.config(function($routeProvider) {
                $routeProvider
                        .when('/', {templateUrl: 'partials/home.html', controller: 'PostsCtrl'})
                        .when('/comments/:id', {templateUrl: 'partials/comments.html', controller: 'CommentsCtrl'})
                        .otherwise({redirectTo: '/'});

            });

            app.factory('PostFactory', function($http, $q) {
                var factory = {
                    posts: false,
                    getPosts: function() {
                        =
                                var deferred = $q.defer();
                        $http.get('posts.json')
                                .success(function(data, status) {
                                    factory.posts = data;
                                    deferred.resolve(factory.posts);
                                }).error(function(data, status) {
                                    deferred.reject('Impossible de récupérer les articles');
                        });
                        return deferred.promise;
                    },
                    getPost: function(id) {
                        var post = {};
                        angular.forEach(factory.posts, function(value, key) {
                            if (value.id === id) {
                                post = value;
                            }
                        });
                        return post;
                    }
                }
                return factory;
            });

            app.controller('PostsCtrl', function($scope, PostFactory) {
                $scope.posts = PostFactory.getPosts();
            });

            app.controller('CommentsCtrl', function($scope, PostFactory, $routeParams) {
                var post = PostFactory.getPost(parseInt($routeParams.id, 10));
                $scope.title = post.name;
                $scope.comments = post.comments;
            });
        </script>
    </head>
    <body ng-app="myApp">
        <div ng-view></div>
    </body>
</html>
